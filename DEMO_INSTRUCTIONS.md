# POS v2.0 演示指南

## 新功能概览

### 1. 统一输入处理
单一输入框自动提取所有信息:
- 时间 (今天、明天、8点)
- 地点 (星巴克、海底捞、医院)
- 人物 (张三、李四、中伟)
- 事件 (开会、吃饭、锻炼)
- 物品 (咖啡、电脑、文件)
- 关系 (人和人、人和地点)

### 2. 去重与消歧
- 别名映射: "中伟" = "张伟" = "张中伟"
- 位置消歧: 根据上下文确定具体地点
- 时间规范化: "早晨8点" → 标准时间格式

### 3. 本地推理系统
基于本体的推理规则:
- 传递性: 朋友的朋友 → 潜在联系人
- 冲突检测: 时间/空间冲突自动发现
- 模式识别: 发现重复行为模式
- 可达性: 迟到预警

### 4. 预测与推荐
智能推荐类型:
- ⏰ 时间推荐: "根据习惯，建议早晨去星巴克"
- 📍 位置推荐: "您经常在这里见李四"
- 👥 社交推荐: "已经30天没联系张三了"
- 🔄 习惯推荐: "您已连续4次周三健身"
- 🔮 预测推荐: "预计明天下午可能开会"
- ⚠️ 冲突警告: "日程冲突！无法同时参加"

## 快速体验

### 1. 启动API服务
```bash
cd /Users/bingo/projects/personal_intelligence/ml-service
python3 unified_api.py
# 服务运行在 http://localhost:8000
```

### 2. 测试统一输入
```bash
# 录入记忆
curl -X POST http://localhost:8000/input \
  -H "Content-Type: application/json" \
  -d '{
    "text": "今天早晨8点在星巴克和中伟讨论项目方案",
    "context": {"current_time": "2024-01-15T08:00:00"}
  }'

# 返回包含:
# - 提取的实体 (中伟/PERSON, 星巴克/PLACE, 早晨8点/TIME)
# - 关系 (中伟-在-星巴克)
# - 推理结果
# - 个性化推荐
```

### 3. 测试智能查询
```bash
# 查询
curl -X POST http://localhost:8000/query \
  -H "Content-Type: application/json" \
  -d '{"text": "找一下我和中伟的记忆", "query_type": "auto"}'

# 自动选择查询策略 (concept匹配)
```

### 4. 获取推荐
```bash
# 获取个性化推荐
curl -X POST http://localhost:8000/recommendations \
  -H "Content-Type: application/json" \
  -d '{
    "context": {
      "current_time": "2024-01-15T08:30:00",
      "location": {"lat": 39.9, "lng": 116.4, "name": "家"}
    },
    "limit": 5
  }'
```

### 5. 事件预测
```bash
# 预测未来24小时
curl "http://localhost:8000/predictions?hours=24"
```

## 系统状态
```bash
curl http://localhost:8000/stats
```

返回:
```json
{
  "memories": 10,
  "concepts": 15,
  "relationships": 8,
  "concept_types": {
    "PERSON": 6,
    "PLACE": 5,
    "EVENT": 4
  }
}
```

## 数据流示例

### 输入处理流程
```
用户输入: "明天晚上在海底捞和女朋友庆祝生日"
           │
           ▼
    ┌─────────────────┐
    │ 1. 实体提取      │
    │ 明天 → DATE      │
    │ 晚上 → TIME      │
    │ 海底捞 → PLACE   │
    │ 女朋友 → PERSON  │
    │ 庆祝生日 → EVENT │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 2. 去重消歧      │
    │ 女朋友 → 女朋友的概念ID
    │ 海底捞 → 海底捞火锅(PLACE)
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 3. 关系抽取      │
    │ 我-在-海底捞     │
    │ 我-和-女朋友     │
    │ 我-参与-庆祝生日 │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 4. 存储          │
    │ 记忆 → 绑定概念  │
    │ 概念 → 关联记忆  │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 5. 推理          │
    │ 应用所有规则     │
    │ 发现模式         │
    └────────┬────────┘
             │
             ▼
    ┌─────────────────┐
    │ 6. 推荐生成      │
    │ 基于情境推荐     │
    │ 预测下次活动     │
    └─────────────────┘
```

### 查询处理流程
```
查询: "找一下我和中伟的记忆"
        │
        ▼
   解析查询 → 提取实体 [中伟/PERSON]
        │
        ▼
   自动选择策略 → concept查询
        │
        ▼
   本体匹配 → 找到中伟的概念ID
        │
        ▼
   查找绑定记忆 → [mem_001, mem_005, mem_010]
        │
        ▼
   关系扩展 → 找到相关人物/地点
        │
        ▼
   融合排序 → 返回结果
```

## 文件清单

### 新增文件
1. `ml-service/unified_input_parser.py` - 统一输入解析
2. `ml-service/prediction_recommendation_engine.py` - 预测推荐引擎
3. `ml-service/unified_api.py` - 统一API服务

### 演示脚本
```bash
# 测试统一输入
python3 unified_input_parser.py

# 启动API服务
python3 unified_api.py

# 运行演示
python3 demo_smart_router.py
```

## 核心改进

| 功能 | v1.0 | v2.0 |
|------|------|------|
| 输入方式 | 多字段表单 | 单一自然语言输入 |
| 实体提取 | 简单NER | 多类型+去重消歧 |
| 关系抽取 | 无 | 自动关系识别 |
| 推理系统 | 无 | 6+推理规则 |
| 预测推荐 | 无 | 智能推荐引擎 |
| 查询策略 | 手动选择 | 自动选择 |

